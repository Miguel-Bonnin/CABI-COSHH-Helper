---
phase: 03-documentation-excellence
plan: 04
type: execute
depends_on: []
files_modified: [TECHNICAL.md]
---

<objective>
Update TECHNICAL.md to document new modules and functions added in Phase 1-2, ensuring technical reference remains accurate and comprehensive.

Purpose: Keep technical documentation in sync with codebase changes from testing foundation and runtime safety phases.
Output: Updated TECHNICAL.md with riskCalculations module, domHelpers module, and validation patterns sections.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-testing-foundation/01-02-SUMMARY.md
@.planning/phases/01-testing-foundation/01-03-SUMMARY.md
@.planning/phases/02-runtime-safety/02-01-SUMMARY.md
@.planning/phases/02-runtime-safety/02-02-SUMMARY.md
@.planning/phases/02-runtime-safety/02-03-SUMMARY.md
@TECHNICAL.md (first 200 lines)
@js/modules/riskCalculations.js
@js/modules/domHelpers.js

**New modules to document:**
- js/modules/riskCalculations.js (Phase 1) - calculateOverallSeverity, calculateOverallLikelihood
- js/modules/domHelpers.js (Phase 2) - safeGetElementById, safeQuerySelector, safeSetTextContent, safeSetInnerHTML, safeAddEventListener

**New patterns to document:**
- Input validation with guard clauses (Phase 2)
- Error types: TypeError for type mismatches, RangeError for out-of-bounds
- Retry logic with exponential backoff
- DOM safety with [DOM] prefixed warnings
</context>

<tasks>

<task type="auto">
  <name>Task 1: Document riskCalculations module in TECHNICAL.md</name>
  <files>TECHNICAL.md</files>
  <action>Update the "Code Structure" section in TECHNICAL.md to add documentation for js/modules/riskCalculations.js module. Add subsection "riskCalculations Module (Phase 1 Extraction)" after the existing key functions documentation. Include: (1) Purpose: Pure calculation functions extracted for testability, (2) Functions: calculateOverallSeverity(hPhrases, signalWord) - calculates severity 1-5 based on H-phrases and signal word; calculateOverallLikelihood(procedure, quantity, materialType, frequency, duration) - calculates likelihood 1-5 from exposure factors. (3) Testing: Full test coverage with 25 tests in tests/riskCalculations.test.js. (4) Note: These functions were extracted from inline HTML in Phase 1 (Jan 2026) to enable automated testing. Include actual function signatures.</action>
  <verify>TECHNICAL.md has riskCalculations module section with function signatures and testing info</verify>
  <done>Risk calculation module documented with purpose, functions, and testing coverage</done>
</task>

<task type="auto">
  <name>Task 2: Document domHelpers module and validation patterns</name>
  <files>TECHNICAL.md</files>
  <action>Add two new subsections to TECHNICAL.md "Code Structure" section: (1) "domHelpers Module (Phase 2 Safety)" explaining the 5 safe DOM helper functions (safeGetElementById, safeQuerySelector, safeSetTextContent, safeSetInnerHTML, safeAddEventListener), their purpose (prevent null reference errors, provide [DOM] warnings for debugging), return values (null for query failures, boolean for mutations), and usage (~70 call sites across codebase). (2) "Validation Patterns (Phase 2)" documenting guard clause pattern at function entry, error types used (TypeError for wrong types, RangeError for out-of-bounds), 18 validation tests, and retry logic with exponential backoff (3 retries max, delay * 2^attempt) for data loading. Include code examples showing guard clause pattern and retry logic.</action>
  <verify>Both subsections exist with helper function descriptions, validation patterns, and code examples</verify>
  <done>DOM helpers and validation patterns documented with implementation details</done>
</task>

<task type="auto">
  <name>Task 3: Update Future Modularization section</name>
  <files>TECHNICAL.md</files>
  <action>Find the "Future Modularization" section in TECHNICAL.md (or create if missing). Update it to reflect Phase 1-2 progress: (1) Mark as PARTIALLY COMPLETE - extraction of riskCalculations module and domHelpers module already done, (2) Update status: "✅ Phase 1 (Jan 2026): Extracted calculation functions to js/modules/riskCalculations.js with full test coverage", "✅ Phase 2 (Jan 2026): Created domHelpers.js and refactored ~70 DOM call sites for safety", (3) Remaining work: Extract MSDS parser into js/modules/msdsParser.js, Extract report generator into js/modules/reportGenerator.js, Consider creating js/modules/formManager.js for form state. Keep realistic and aligned with actual progress - 2 of ~5 planned extractions complete.</action>
  <verify>Future Modularization section updated with Phase 1-2 progress and remaining work</verify>
  <done>Modularization roadmap reflects completed work and realistic remaining tasks</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] TECHNICAL.md has riskCalculations module section with accurate function signatures
- [ ] domHelpers module documented with all 5 functions
- [ ] Validation patterns section includes guard clauses, error types, and retry logic
- [ ] Code examples are accurate and runnable
- [ ] Future Modularization section shows realistic progress
- [ ] Table of Contents updated to reflect new sections (if TOC exists)
- [ ] Overall document remains readable and well-organized
</verification>

<success_criteria>

- TECHNICAL.md updated with Phase 1-2 module documentation
- riskCalculations module fully documented with function signatures
- domHelpers module and validation patterns explained with examples
- Future Modularization section reflects actual progress
- Technical reference remains comprehensive and accurate
</success_criteria>

<output>
After completion, create `.planning/phases/03-documentation-excellence/03-04-SUMMARY.md`:

# Phase 3 Plan 4: TECHNICAL.md Updates Summary

**Technical documentation synchronized with Phase 1-2 codebase changes**

## Accomplishments

- Documented riskCalculations module with function signatures and test coverage
- Documented domHelpers module with 5 safe DOM functions and usage patterns
- Added Validation Patterns section explaining guard clauses and error types
- Updated Future Modularization section to show Phase 1-2 progress (2 of 5 extractions complete)
- Maintained technical reference accuracy and comprehensiveness

## Files Created/Modified

- `TECHNICAL.md` - Updated with ~100-150 lines of new documentation

## Decisions Made

[Document any choices made during implementation, or "None"]

## Issues Encountered

[Document any problems and resolutions, or "None"]

## Next Step

Ready for 03-05-PLAN.md (inline code documentation) or Phase 3 complete if 03-05 skipped
</output>
