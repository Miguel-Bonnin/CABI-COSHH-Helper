---
phase: 04-code-quality
plan: 02
type: execute
depends_on: ["04-01"]
files_modified: [.prettierrc, .eslintrc.json, js/**/*.js, coshhgeneratorv5.html]
---

<objective>
Establish code formatting standards and apply consistent style across the codebase.

Purpose: Eliminate inconsistent semicolons, quotes, and indentation that make code harder to read and cause merge conflicts. Automate style enforcement.
Output: Prettier and ESLint configurations, all JavaScript files formatted consistently, style guide documented.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-code-quality/04-01-SUMMARY.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/CONCERNS.md

**Tech stack available:**
- Node.js with npm
- Vitest for testing
- ES6 modules

**Established patterns:**
- Files: kebab-case
- Functions: camelCase
- 4 spaces for JavaScript indentation

**Current concerns from CONVENTIONS.md:**
- Inconsistent quotes (mix of single and double)
- Inconsistent semicolons (some lines have them, some don't)
- No linting tool configured
- No automated formatting

**Current concerns from CONCERNS.md:**
- Mixed code style makes code harder to read
- Merge conflicts more likely with inconsistent formatting
- No enforced standards across contributors
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Prettier and ESLint configuration</name>
  <files>.prettierrc, .eslintrc.json, package.json</files>
  <action>
Install Prettier and ESLint:
```bash
npm install --save-dev prettier eslint
```

Create .prettierrc with project standards:
```json
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 4,
  "trailingComma": "es5",
  "printWidth": 100,
  "arrowParens": "avoid"
}
```

Create .eslintrc.json with standard JavaScript rules:
```json
{
  "env": {
    "browser": true,
    "es2021": true,
    "node": true
  },
  "extends": "eslint:recommended",
  "parserOptions": {
    "ecmaVersion": "latest",
    "sourceType": "module"
  },
  "rules": {
    "no-unused-vars": "warn",
    "no-console": "off",
    "semi": ["error", "always"],
    "quotes": ["error", "single", { "avoidEscape": true }]
  }
}
```

Add scripts to package.json:
```json
"scripts": {
  "format": "prettier --write \"js/**/*.js\" \"tests/**/*.js\"",
  "format:check": "prettier --check \"js/**/*.js\" \"tests/**/*.js\"",
  "lint": "eslint js/**/*.js tests/**/*.js",
  "lint:fix": "eslint --fix js/**/*.js tests/**/*.js"
}
```

Why: Prettier handles formatting automatically, ESLint catches potential bugs. These configs match existing conventions (4 spaces, semicolons, single quotes).
  </action>
  <verify>
```bash
npm run format:check
npm run lint
```
Both commands should run without crashing. format:check will show files that need formatting (expected at this stage).
  </verify>
  <done>
- .prettierrc exists with project formatting rules
- .eslintrc.json exists with JavaScript linting rules
- package.json has format and lint scripts
- npm run format:check and npm run lint execute successfully
- Prettier and ESLint packages installed in node_modules
  </done>
</task>

<task type="auto">
  <name>Task 2: Apply automated formatting and fix linting issues</name>
  <files>js/**/*.js, tests/**/*.js, admin-scripts/*.js</files>
  <action>
Run Prettier to format all JavaScript files:
```bash
npm run format
```

Run ESLint auto-fix to address fixable issues:
```bash
npm run lint:fix
```

Review remaining ESLint warnings (no-unused-vars):
- If variable is genuinely unused: remove it
- If variable is used in HTML onclick: add /* exported */ comment
- If variable is for debugging: keep with /* eslint-disable-line no-unused-vars */

Manual review of changes:
- Check git diff to ensure formatting changes are reasonable
- Verify no logic changes, only style
- Test that formatted code still runs correctly

Don't format:
- node_modules/ (excluded by default)
- HTML inline scripts (will be addressed in future phases)

Why: Automated formatting eliminates style debates and ensures consistency. ESLint auto-fix catches common errors like missing semicolons.
  </action>
  <verify>
```bash
npm run format:check
npm run lint
npm test
```
All commands should pass:
- format:check: All files pass formatting check
- lint: No errors, only acceptable warnings
- test: All 69+ tests still pass
  </verify>
  <done>
- All JavaScript files formatted consistently with Prettier
- ESLint issues auto-fixed where possible
- Remaining ESLint warnings documented with eslint-disable comments
- npm run format:check passes (no formatting issues)
- npm run lint passes (no errors)
- npm test passes (no breaking changes)
- Code style is consistent across all .js files
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run format:check passes
- [ ] npm run lint passes with 0 errors
- [ ] npm test passes (all 69+ tests)
- [ ] Git diff shows only style changes, no logic changes
- [ ] Manual spot-check: Open 3-4 files, verify consistent formatting
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Prettier and ESLint configured and working
- All JavaScript files formatted consistently
- No breaking changes to functionality
- Future code will follow enforced standards
</success_criteria>

<output>
After completion, create `.planning/phases/04-code-quality/04-02-SUMMARY.md`:

# Phase 4 Plan 2: Code Formatting & Style Summary

**Established Prettier and ESLint standards, formatted 8+ JavaScript files consistently**

## Accomplishments

- Added Prettier configuration with 4-space tabs, single quotes, semicolons
- Added ESLint configuration with recommended rules
- Formatted all JavaScript files automatically
- Fixed auto-fixable linting issues
- Added npm scripts for format and lint checks

## Files Created/Modified

- `.prettierrc` - NEW: Formatting configuration
- `.eslintrc.json` - NEW: Linting rules
- `package.json` - Added format and lint scripts
- `js/**/*.js` - Formatted consistently (8 files)
- `tests/**/*.js` - Formatted consistently
- `admin-scripts/*.js` - Formatted consistently

## Decisions Made

[Specific formatting rules chosen, how remaining ESLint warnings were handled]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 04-03-PLAN.md - Refactor Long Functions
</output>
