---
phase: 01-testing-foundation
plan: 01
type: execute
depends_on: []
files_modified: [package.json, vitest.config.js, tests/setup.test.js]
---

<objective>
Set up automated testing infrastructure with Vitest and happy-dom to enable test-driven development for the CABI COSHH Helper.

Purpose: Establish the foundation for preventing regressions and improving code quality through automated testing.
Output: Working test framework that can run tests with `npm test`, configured for DOM testing.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-testing-foundation/DISCOVERY.md
@.planning/codebase/STACK.md
@.planning/codebase/TESTING.md

**Current State:**
- No package.json exists (pure static site)
- No test framework configured
- Vanilla JavaScript application with functions in HTML and modules
- Deployed to GitHub Pages as static files

**Decision from Discovery:**
- Using Vitest (modern, fast, ESM-native)
- happy-dom for DOM simulation
- Test directory: `tests/`
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create package.json and install Vitest</name>
  <files>package.json</files>
  <action>
Initialize Node.js project with `npm init -y`. Set name to "cabi-coshh-helper", version "1.0.0", add "type": "module" for ES modules. Install Vitest and happy-dom as dev dependencies: `npm install -D vitest happy-dom`. Add test script to package.json: "test": "vitest", "test:ui": "vitest --ui". Do NOT install @vitest/ui yet (optional). Keep dependencies minimal - only vitest and happy-dom.
  </action>
  <verify>package.json exists with vitest and happy-dom in devDependencies, "type": "module" is set, test script exists</verify>
  <done>package.json valid, node_modules created, npm test command available</done>
</task>

<task type="auto">
  <name>Task 2: Configure Vitest and create smoke test</name>
  <files>vitest.config.js, tests/setup.test.js</files>
  <action>
Create vitest.config.js in root with environment: 'happy-dom' for DOM testing. Add test include pattern: ['tests/**/*.test.js']. Create tests/ directory. Write smoke test in tests/setup.test.js: import { describe, it, expect } from 'vitest'; Test that 1 + 1 === 2 to verify framework works. Run `npm test` to verify - should pass with 1 test.
  </action>
  <verify>npm test runs and passes, vitest.config.js exists with happy-dom environment</verify>
  <done>Smoke test passes, Vitest configured correctly, test framework operational</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm test` executes without errors
- [ ] Smoke test passes (1 test passing)
- [ ] package.json has correct dependencies and scripts
- [ ] vitest.config.js exists with DOM environment configured
</verification>

<success_criteria>

- All tasks completed
- Test framework installed and functional
- Smoke test demonstrates Vitest is working
- Ready to write real tests in next plan
  </success_criteria>

<output>
After completion, create `.planning/phases/01-testing-foundation/01-01-SUMMARY.md`:

# Phase 1 Plan 1: Test Infrastructure Setup Summary

**Vitest test framework installed and configured for DOM testing**

## Accomplishments

- Created package.json with Vitest and happy-dom dependencies
- Configured Vitest for ES modules and DOM environment
- Verified setup with passing smoke test
- Established tests/ directory structure

## Files Created/Modified

- `package.json` - Node.js dependencies and test scripts
- `vitest.config.js` - Vitest configuration with happy-dom
- `tests/setup.test.js` - Smoke test to verify framework
- `node_modules/` - Dependencies (gitignored)

## Decisions Made

- Used happy-dom over jsdom (lighter, faster for our use case)
- Set "type": "module" in package.json for ES module support
- Test directory at root level: `tests/` (common pattern)

## Issues Encountered

None expected - straightforward setup

## Next Step

Ready for 01-02-PLAN.md: Extract risk calculation functions and write TDD tests
</output>
