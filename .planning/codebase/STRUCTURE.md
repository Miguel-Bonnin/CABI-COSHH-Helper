# Codebase Structure

**Analysis Date:** 2026-01-13

## Directory Layout

```
CABI-COSHH-Helper/
├── admin-scripts/          # Admin utilities for data management
├── assets/                 # Static assets (images, SVGs)
├── css/                    # Modularized stylesheets
├── data/                   # Static data files (inventory, tracking, WEL)
│   ├── inventory/          # Chemical inventory JSON
│   └── tracking/           # Assessment status tracking
├── docs/                   # Additional documentation
├── examples/               # Example MSDS and assessment files
├── js/                     # JavaScript modules
│   └── config/             # Configuration data modules
├── .claude/                # Claude Code configuration
├── .git/                   # Git repository
├── .planning/              # GSD project planning files
├── coshhgeneratorv5.html   # Main application file
├── eh40_table.csv          # UK HSE Workplace Exposure Limits
├── ghs_*.svg               # GHS pictogram assets (9 files)
├── CHANGELOG.md            # Version history
├── README.md               # User documentation
└── TECHNICAL.md            # Developer documentation
```

## Directory Purposes

**admin-scripts/**
- Purpose: Administrative utilities for data fetching and management
- Contains: JavaScript files for API interactions, data generation
- Key files:
  - `fetch-inventory.js` - Fetch chemical inventory from ChemInventory API
  - `generate-status.js` - Generate assessment status tracking file
  - `msds-proxy.js` - Proxy service for fetching MSDS documents
  - `test-api.js` - API testing utility
  - `debug-response.js` - Debugging tool for API responses
- Subdirectories: None
- Usage: Run with Node.js on admin machine (not deployed to production)

**assets/**
- Purpose: Static images and visual assets
- Contains: CABI branding, documentation images
- Key files: TBD (directory exists but not examined in detail)
- Subdirectories: None detected

**css/**
- Purpose: Modularized stylesheets (Phase 1 refactoring from monolithic HTML)
- Contains: CSS files organized by concern
- Key files:
  - `layout.css` - Page layout, grid, containers
  - `tabs.css` - Tab navigation styling
  - `forms.css` - Form controls, inputs, buttons
  - `tables.css` - Table styles for inventory and reports
  - `print.css` - Print-specific styles for COSHH reports
  - `inventory.css` - Inventory table and stats styling
  - `floor-plan.css` - Floor plan viewer styles
- Subdirectories: None

**data/**
- Purpose: Static data files for application functionality
- Contains: JSON and CSV data files
- Key files:
  - `inventory/chemical-inventory.json` - Generated by admin scripts, lists all chemicals
  - `tracking/assessment-status.json` - Assessment completion tracking
- Subdirectories:
  - `inventory/` - Chemical inventory data
  - `tracking/` - Assessment status data

**docs/**
- Purpose: Additional documentation beyond README
- Contains: Extended documentation, guides
- Key files: TBD (not examined in detail)

**examples/**
- Purpose: Example files for testing and demonstration
- Contains: Sample MSDS PDF, completed assessment JSON, output report PDF
- Key files:
  - `HiDi Formamide.pdf` - Example MSDS for testing parser
  - `cabi_coshh_dynamic_2025-10-07.json` - Pre-filled assessment data
  - `coshhform-hidi.pdf` - Completed COSHH report example
- Note: Linked directly in application MSDS tab

**js/**
- Purpose: JavaScript application code (Phase 2 modularization)
- Contains: Module scripts organized by function
- Subdirectories:
  - `config/` - Configuration data modules
- Key files:
  - `eh40-loader.js` - Load UK HSE Workplace Exposure Limits
  - `inventory-manager.js` - Inventory table rendering and filtering
  - `floor-plan-viewer.js` - Floor plan visualization feature

**js/config/**
- Purpose: Configuration data exported as JavaScript modules
- Contains: Risk assessment rules and control recommendations
- Key files:
  - `procedures.js` - Lab procedure definitions (pipetting, weighing, etc.)
  - `hazards.js` - H-phrase severity mappings and hazard group classifications
  - `controls.js` - Control band recommendations and PPE guidance
- Pattern: Export const objects for import in main application

**.claude/**
- Purpose: Claude Code (CLI) configuration
- Contains: Claude settings and GSD (Get Shit Done) templates
- Subdirectories:
  - `get-shit-done/` - GSD skill resources

**.planning/**
- Purpose: Project planning files for GSD workflow
- Contains: Codebase analysis documents (this file and others)
- Subdirectories:
  - `codebase/` - Codebase mapping documents (STACK.md, ARCHITECTURE.md, etc.)

## Key File Locations

**Entry Points:**
- `coshhgeneratorv5.html` - Main application (SPA with embedded JavaScript)

**Configuration:**
- `js/config/procedures.js` - Lab procedure definitions
- `js/config/hazards.js` - H-phrase mappings
- `js/config/controls.js` - Control band data
- `.gitignore` - Git exclusions
- `.claude/settings.local.json` - Claude Code settings

**Core Logic:**
- `coshhgeneratorv5.html` (embedded `<script>` section) - Risk calculation, PDF parsing, report generation
- `js/inventory-manager.js` - Inventory table management
- `js/eh40-loader.js` - Workplace exposure limits loading
- `js/floor-plan-viewer.js` - Floor plan visualization

**Testing:**
- None detected - no test files or test directory

**Documentation:**
- `README.md` - User-facing documentation
- `TECHNICAL.md` - Comprehensive developer documentation (~1,600 lines)
- `CHANGELOG.md` - Version history
- `INVENTORY-README.md` - Inventory feature documentation

## Naming Conventions

**Files:**
- kebab-case for all files: `inventory-manager.js`, `floor-plan-viewer.js`
- UPPERCASE for documentation: `README.md`, `TECHNICAL.md`, `CHANGELOG.md`
- Suffixes: `.html` (main app), `.js` (scripts), `.css` (styles), `.json` (data), `.csv` (tabular data)

**Directories:**
- kebab-case: `admin-scripts/`, `get-shit-done/`
- Single words: `css/`, `js/`, `data/`, `docs/`, `examples/`, `assets/`

**Special Patterns:**
- `ghs_*.svg` - GHS pictogram assets (9 files: explosive, flammable, oxidising, etc.)
- `eh40_table.csv` - UK HSE workplace exposure limits
- `coshhgeneratorv5.html` - Version number in filename

## Where to Add New Code

**New Feature Module:**
- Primary code: `js/feature-name.js` (e.g., `js/audit-trail.js`)
- Import in: `coshhgeneratorv5.html` `<script src="js/feature-name.js"></script>`
- Styles: `css/feature-name.css` (if UI component)
- Data: `data/feature-name/` (if requires static data)

**New Risk Assessment Rule:**
- Configuration: `js/config/hazards.js` or `js/config/controls.js`
- Documentation: Update `TECHNICAL.md` "Customization Guide" section

**New Lab Procedure:**
- Add to: `js/config/procedures.js` (procedureData object)
- Update HTML: `coshhgeneratorv5.html` `<select id="labProcedure">` dropdown

**New Admin Script:**
- Implementation: `admin-scripts/script-name.js`
- Document in: `README.md` or `INVENTORY-README.md`

**Utilities:**
- No dedicated utilities directory yet
- Candidate location: `js/utils/` (to be created)
- Current pattern: Embed utility functions in main script or feature modules

## Special Directories

**admin-scripts/**
- Purpose: Admin-only utilities, not deployed to production
- Source: Manual execution on admin machine
- Committed: Yes (source control for reproducibility)
- Access: Requires ChemInventory API credentials (not in repo)

**data/**
- Purpose: Generated data files from admin scripts
- Source: Output of `admin-scripts/fetch-inventory.js` and `admin-scripts/generate-status.js`
- Committed: Yes (provides data for production deployment)
- Updates: Admin manually re-runs scripts and commits updated data

**examples/**
- Purpose: Example files linked in application UI
- Source: Real COSHH assessment examples
- Committed: Yes (needed for "Try an Example" feature)

**.planning/codebase/**
- Purpose: Codebase analysis for GSD workflow
- Source: Generated by `/gsd:map-codebase` command
- Committed: Not yet (will be added in next commit)

---

*Structure analysis: 2026-01-13*
*Update when directory structure changes*
